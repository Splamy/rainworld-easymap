<!DOCTYPE html>
<html>

<head>
	<title>amogus?</title>
	<style>
		body {
			background: darkgray;
			margin: 0;
			padding: 0;
		}

		.map {
			position: absolute;
			top: 0;
			left: 0;
		}

		img {
			/* IE, only works on <img> tags */
			-ms-interpolation-mode: nearest-neighbor;
			/* Firefox */
			image-rendering: crisp-edges;
			/* Chromium + Safari */
			image-rendering: pixelated;
		}

		.ui {
			padding: .5em;
			position: fixed;
			background-color: #eee;
			border-radius: 0 0 .3em 0;
			display: flex;
			align-items: center;
		}
	</style>
	<script src="https://unpkg.com/panzoom@9.4.0/dist/panzoom.min.js"
		integrity="sha256-0dwB5HJ3NFJpgfYQEhC/O15SjlPVMK/7r3ShU8ZnjNU=" crossorigin="anonymous"></script>
</head>

<body>
	<div id="map_selections" style="position: absolute;z-index: 10;display: flex;">
	</div>
	<div id="imgContainer">
	</div>

	<script>
		const pan = document.querySelector("#imgContainer");
		const map_selections = document.getElementById("map_selections");
		let pzInstance = panzoom(pan, {
			initialZoom: 0.2,
		});

		const maps = new Map();
		function createMap(tag, map_src, offX, offY) {
			return { tag, map_src, offX, offY };
		}
		function setupMap(tag, icon_src, map_src, offX, offY) {
			const map = createMap(tag, map_src, offX, offY);
			maps.set(tag, map);
			const btn = document.createElement("img");
			btn.src = icon_src;
			btn.onclick = () => setbg(tag);
			map_selections.appendChild(btn);
		}

		function getHash() {
			const url = new URL(window.location);
			return url.hash.substring(1);
		}

		function setHash(hash) {
			const url = new URL(window.location);
			url.hash = `#${hash}`;
			window.history.pushState({}, '', url);
		}

		function setbg(tag) {
			const data = maps.get(tag);
			const imgs = [...pan.children];
			imgs.forEach(i => i.style.display = "none");
			let img = imgs.find(i => i.dataset.map_name === data.tag);
			if (!img) {
				img = document.createElement("img");
				img.classList.add("map");
				img.src = data.map_src;
				img.style.left = `${data.offX}px`;
				img.style.top = `${data.offY}px`;
				img.dataset.map_name = data.tag;
				pan.appendChild(img);
			}
			img.style.display = "block";
			setHash(tag);
		}

		setupMap('Vanilla', "img/Survivor_icon_%28custom%29.png", 'img/World_Map_%28Vanilla%29.png', 2453, -464);
		setupMap('Downpour', "img/Gourmand_icon_%28custom%29.png", 'img/World_Map_%28Downpour%29.png', 0, 0);
		setupMap('Artificer', "img/Artificer_icon_%28custom%29.png", 'img/World_Map_%28Artificer%29.png', 2180, -1200);
		setupMap('Rivulet', "img/Rivulet_icon_%28custom%29.png", 'img/World_Map_%28Rivulet%29.png', 2180, 0);
		setupMap('Spearmaster', "img/Spearmaster_icon_%28custom%29.png", 'img/World_Map_%28Spearmaster%29.png', 2180, 0);
		setupMap('Saint', "img/Saint_icon_%28custom%29.png", 'img/World_Map_%28Saint%29.png', 2180, 803);

		let currentHash = getHash();
		if (currentHash) {
			setbg(currentHash);
		}
	</script>
</body>

</html>
